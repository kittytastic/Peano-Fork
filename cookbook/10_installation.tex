\chapter{Installation}

There are two ways to obtain Peano: 
You can either download one of the archives we provide on the webpage, or you
can work directly against a repository clone.
If you work with the archive, type in a 
\begin{code}
tar -xzvf myarchive.tar.gz
\end{code}
in the directory where you've stored your downloaded file.


If you work with the git archive, you have to clone this archive first. 
I grant access to Peano free of charge.
However, I ask users to sign up for the software first.
This way I can report to funding agencies how frequent the software is used, and
I also have at least some ideas which application areas benefit from the
software and where it is ran.
\begin{code}
git clone https://gitlab.lrz.de/your-login/Peano.git
cd Peano
git checkout p4
\end{code}


I still maintain the ``old'' Peano in the repository (version 3), and most users
consider this to be the standard Peano generation.
For the present document, it is thus important that you manually switch to the
branch \texttt{p4}.


\section{Configure}
\label{section:installation:configure}


Peano relies on the autotools to set up its build environment.
Change into the project's directory and type in 
\begin{code}
./configure --help
\end{code}


\begin{remark}
 If you clone the repository, i.e.~if you work directly against the git, you
 will have to create the configure scripts manually. 
 This can be achived by running the following six commands:  
 \begin{code}
 libtoolize; aclocal; autoconf; autoheader; 
 cp src/config.h.in .; 
 automake --add-missing
 \end{code}
\end{remark}


The \texttt{--help} option should give you some information about the available
variants of Peano.
In principle, a sole \texttt{./configure} call is sufficient, but you might want
to adopt your build; notably as the default build is serial and does not bring
along any support for postprocessing.
While the help output should be reasonable verbose, I summarise key options
below:

\begin{center}
 \begin{tabular}{lp{10cm}}
  \texttt{--prefix=/mypath} & Will install Peano in \texttt{/mypath}.
   \\
  \texttt{--with-multithreading} & Switch on multithreading. By default, we
  build without multithreading, but a \texttt{--with-multithreading=cpp}, e.g.,
  makes Peano use the C++ threading model. 
   \\
  \texttt{--with-mpi} & Enable the MPI version of Peano. You have to tell the
  build environment however which compile command to use. Please note that
  we need a C++ MPI wrapper. So \texttt{--with-mpi=mpcxx} is a typical call. 
   \\
  \texttt{--with-vtk} & Inform Peano that VTK is available on the system and
  that it should build all the visualisation and postprocessing tools that rely
  upon VTK.
   \\
  \texttt{--with-hdf5} & Make Peano support HDF5 output. 
   \\
  \texttt{--with-delta} & Configure Peano such that the geometry library
  $\Delta $ is used.
 \end{tabular}
\end{center}


\section{Build}

Once the configuration has been successful, a simple 
\begin{code}
make
\end{code}
should build the Peano core and some examples.


\begin{code}
make install
\end{code}
finally will deploy the Peano files in the directory specified via the
\texttt{prefix} before.


\section{Peano components and build variants}

Peano currently is delivered as a set of archives, i.e.~static libraries:
\begin{itemize}
  \item There is a technical architecture (\texttt{Tarch}) and the actual
  \texttt{Peano4Core}.
  \item Each archive variant is available as a release version, as a debug
  version, as a version with tracing and assertions and as a tracing-only
  version.
  \item Each archive variant is available as 2d build and as 3d build. If you
  need higher dimensions, you have to build the required libraries manually.
\end{itemize}


The version terminology is as follows:
\begin{itemize}
  \item {\bf debug} The debug versions of the archives all have the postfix
  \texttt{\_debug}. If you link against these versions, the full set of
  assertions, of all tracing and all debug messages is available; though you can
  always filter on the application-level which information you want to see
  (cmp.~Chapter \ref{section:logging}).
  \item {\bf asserts} Thsee versions of the archives all have the postfix
  \texttt{\_asserts}. If you link against these versions, all assertions are on.
  The code also contains tracing macros (see below).
  \item {\bf tracing} The release versions of the archives all have the postfix
  \texttt{\_trace}. If you link against these versions, all assertions and debug
  messages are removed, but some tracing is active. You can switch on/off the
  tracing per class (cmp.~Chapter \ref{section:logging}), and different tracing
  backends allow you to connect to different (profiling) tools.
  \item {\bf release} The release versions of the archives have no
  particular postfix. They disable tracing, any debugging and all assertions.
  These archives should be used by production runs.
\end{itemize}


\noindent
Besides these archives, the Peano installation also comes along with a set of
example applications.
They are found in the directory \texttt{src/examples}.
Most examples create by default two variants of the example: a debug
version and one with only tracing enabled.
Several examples furthermore come along as 2d and 3d build.


\section{Installation test}

Once you have compiled Peano4, I recommend that you run the unit tests in
directory

\begin{code}
  src/examples/unittests/UnitTests2d
  src/examples/unittests/UnitTests3d
\end{code}

\noindent
You can run these builds with different core counts and also MPI support if you
have compiled with MPI.
The executables contain both node correctness tests and MPI ping-pong tests,
i.e.~you can both assess a valid build plus a working MPI environment.

