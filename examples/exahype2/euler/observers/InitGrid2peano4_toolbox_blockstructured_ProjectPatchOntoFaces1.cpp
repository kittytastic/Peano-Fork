#include "InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1.h"


tarch::logging::Log examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::_log( "examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1");





examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1(int treeNumber) {
}


examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::~InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1() {
}


std::vector< peano4::grid::GridControlEvent > examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::getGridControlEvents() const {
  return std::vector< peano4::grid::GridControlEvent >();
}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::beginTraversal(
      ) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::endTraversal(
      ) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::createPersistentFace(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::euler::facedata::EulerQ& fineGridFaceEulerQ,
      examples::exahype2::euler::facedata::EulerQNew& fineGridFaceEulerQNew,
      examples::exahype2::euler::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::destroyPersistentFace(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::euler::facedata::EulerQ& fineGridFaceEulerQ,
      examples::exahype2::euler::facedata::EulerQNew& fineGridFaceEulerQNew,
      examples::exahype2::euler::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::createHangingFace(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::euler::facedata::EulerQ& fineGridFaceEulerQ,
      examples::exahype2::euler::facedata::EulerQNew& fineGridFaceEulerQNew,
      examples::exahype2::euler::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::destroyHangingFace(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::euler::facedata::EulerQ& fineGridFaceEulerQ,
      examples::exahype2::euler::facedata::EulerQNew& fineGridFaceEulerQNew,
      examples::exahype2::euler::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::touchFaceFirstTime(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::euler::facedata::EulerQ& fineGridFaceEulerQ,
      examples::exahype2::euler::facedata::EulerQNew& fineGridFaceEulerQNew,
      examples::exahype2::euler::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::touchFaceLastTime(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::euler::facedata::EulerQ& fineGridFaceEulerQ,
      examples::exahype2::euler::facedata::EulerQNew& fineGridFaceEulerQNew,
      examples::exahype2::euler::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::createCell(
      const peano4::datamanagement::CellMarker& marker,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> fineGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> fineGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> fineGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& fineGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& fineGridCellEulerCellSemaphoreLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::destroyCell(
      const peano4::datamanagement::CellMarker& marker,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> fineGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> fineGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> fineGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& fineGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& fineGridCellEulerCellSemaphoreLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::touchCellFirstTime(
      const peano4::datamanagement::CellMarker& marker,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> fineGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> fineGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> fineGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& fineGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& fineGridCellEulerCellSemaphoreLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {


}


void examples::exahype2::euler::observers::InitGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces1::touchCellLastTime(
      const peano4::datamanagement::CellMarker& marker,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> fineGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> fineGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> fineGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& fineGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& fineGridCellEulerCellSemaphoreLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQ> coarseGridFacesEulerQ,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::EulerQNew> coarseGridFacesEulerQNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::euler::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::euler::celldata::EulerQ& coarseGridCellEulerQ,
      examples::exahype2::euler::celldata::EulerCellSemaphoreLabel& coarseGridCellEulerCellSemaphoreLabel) {

  auto serialisePatchIndex = [](tarch::la::Vector<Dimensions,int> overlapCell, int normal) {
    int base   = 1;
    int result = 0;
    for (int d=0; d<Dimensions; d++) {
      result += overlapCell(d) * base;
      if (d==normal) {
        base *= 1.0*2;
      }
      else {
        base *= 7;
      }
    }
    return result;
  };
  
  if ( not marker.isRefined() and (   (InstanceOfEuler.getSolverState()==Euler::SolverState::Primary                         and marker.isSkeletonCell() ) or (InstanceOfEuler.getSolverState()==Euler::SolverState::PrimaryAfterGridInitialisation  and marker.isSkeletonCell() ) or (InstanceOfEuler.getSolverState()==Euler::SolverState::Secondary                       and marker.isEnclaveCell() ) or (InstanceOfEuler.getSolverState()==Euler::SolverState::GridInitialisation )) ) {
    logTraceIn( "touchCellLastTime(...)" );
  
    for(int d=0; d<Dimensions; d++) {
      /**
       * d-loop over all dimensions except d. The vector k's entry d is set
       * to 0. We start with the left/bottom face, i.e. the one closer to the 
       * coordinate system's origin.
       */
      dfore(k,7,d,0) {
        for (int i=0; i<1.0; i++) {
          tarch::la::Vector<Dimensions,int> patchCell   = k;
          tarch::la::Vector<Dimensions,int> overlapCell = k;
          patchCell(d)   = i;
          overlapCell(d) = i+1.0;
          
          int patchCellSerialised   = peano4::utils::dLinearised(patchCell,7);
          int overlapCellSerialised = serialisePatchIndex(overlapCell,d);
          for (int j=0; j<5; j++) {
            fineGridFacesEulerQNew(d).value[overlapCellSerialised*5+j] = 
              fineGridCellEulerQ.value[patchCellSerialised*5+j];
          }
  
          patchCell(d)   = i+7-1.0;
          overlapCell(d) = i;
          
          patchCellSerialised   = peano4::utils::dLinearised(patchCell,7);
          overlapCellSerialised = serialisePatchIndex(overlapCell,d);
          for (int j=0; j<5; j++) {
            fineGridFacesEulerQNew(d+Dimensions).value[overlapCellSerialised*5+j] = 
              fineGridCellEulerQ.value[patchCellSerialised*5+j];
          }
        }
      }
    }
    logTraceOut( "touchCellLastTime(...)" );
  }

}


