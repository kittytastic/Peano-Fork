#include "CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0.h"


tarch::logging::Log examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::_log( "examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0");





examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0(int treeNumber) {
}


examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::~CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0() {
}


std::vector< peano4::grid::GridControlEvent > examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::getGridControlEvents() {
  return std::vector< peano4::grid::GridControlEvent >();
}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::beginTraversal(
      ) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::endTraversal(
      ) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::createPersistentFace(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::loh1::facedata::LOH1Q& fineGridFaceLOH1Q,
      examples::exahype2::loh1::facedata::LOH1QNew& fineGridFaceLOH1QNew,
      examples::exahype2::loh1::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::destroyPersistentFace(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::loh1::facedata::LOH1Q& fineGridFaceLOH1Q,
      examples::exahype2::loh1::facedata::LOH1QNew& fineGridFaceLOH1QNew,
      examples::exahype2::loh1::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::createHangingFace(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::loh1::facedata::LOH1Q& fineGridFaceLOH1Q,
      examples::exahype2::loh1::facedata::LOH1QNew& fineGridFaceLOH1QNew,
      examples::exahype2::loh1::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::destroyHangingFace(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::loh1::facedata::LOH1Q& fineGridFaceLOH1Q,
      examples::exahype2::loh1::facedata::LOH1QNew& fineGridFaceLOH1QNew,
      examples::exahype2::loh1::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::touchFaceFirstTime(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::loh1::facedata::LOH1Q& fineGridFaceLOH1Q,
      examples::exahype2::loh1::facedata::LOH1QNew& fineGridFaceLOH1QNew,
      examples::exahype2::loh1::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::touchFaceLastTime(
      const peano4::datamanagement::FaceMarker& marker,
      examples::exahype2::loh1::facedata::LOH1Q& fineGridFaceLOH1Q,
      examples::exahype2::loh1::facedata::LOH1QNew& fineGridFaceLOH1QNew,
      examples::exahype2::loh1::facedata::Label& fineGridFaceLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::createCell(
      const peano4::datamanagement::CellMarker& marker,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> fineGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> fineGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> fineGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& fineGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& fineGridCellLOH1CellSemaphoreLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::destroyCell(
      const peano4::datamanagement::CellMarker& marker,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> fineGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> fineGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> fineGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& fineGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& fineGridCellLOH1CellSemaphoreLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::touchCellFirstTime(
      const peano4::datamanagement::CellMarker& marker,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> fineGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> fineGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> fineGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& fineGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& fineGridCellLOH1CellSemaphoreLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

}


void examples::exahype2::loh1::observers::CreateGrid2peano4_toolbox_blockstructured_ProjectPatchOntoFaces0::touchCellLastTime(
      const peano4::datamanagement::CellMarker& marker,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> fineGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> fineGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> fineGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& fineGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& fineGridCellLOH1CellSemaphoreLabel,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1Q> coarseGridFacesLOH1Q,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::LOH1QNew> coarseGridFacesLOH1QNew,
      peano4::datamanagement::FaceEnumerator<examples::exahype2::loh1::facedata::Label> coarseGridFacesLabel,
      examples::exahype2::loh1::celldata::LOH1Q& coarseGridCellLOH1Q,
      examples::exahype2::loh1::celldata::LOH1CellSemaphoreLabel& coarseGridCellLOH1CellSemaphoreLabel) {

  auto serialisePatchIndex = [](tarch::la::Vector<Dimensions,int> overlapCell, int normal) {
    int base   = 1;
    int result = 0;
    for (int d=0; d<Dimensions; d++) {
      result += overlapCell(d) * base;
      if (d==normal) {
        base *= 1.0*2;
      }
      else {
        base *= 5;
      }
    }
    return result;
  };
  
  if (    (InstanceOfLOH1.getSolverState()==LOH1::SolverState::Primary                         and marker.isSkeletonCell() ) or (InstanceOfLOH1.getSolverState()==LOH1::SolverState::PrimaryAfterGridInitialisation  and marker.isSkeletonCell() ) or (InstanceOfLOH1.getSolverState()==LOH1::SolverState::Secondary                       and marker.isEnclaveCell() ) or (InstanceOfLOH1.getSolverState()==LOH1::SolverState::GridInitialisation ) ) {
    logTraceIn( "touchCellLastTime(...)" );
  
    for(int d=0; d<Dimensions; d++) {
      /**
       * d-loop over all dimensions except d. The vector k's entry d is set
       * to 0. We start with the left/bottom face, i.e. the one closer to the 
       * coordinate system's origin.
       */
      dfore(k,5,d,0) {
        for (int i=0; i<1.0; i++) {
          tarch::la::Vector<Dimensions,int> patchCell   = k;
          tarch::la::Vector<Dimensions,int> overlapCell = k;
          patchCell(d)   = i;
          overlapCell(d) = i+1.0;
          
          int patchCellSerialised   = peano4::utils::dLinearised(patchCell,5);
          int overlapCellSerialised = serialisePatchIndex(overlapCell,d);
          for (int j=0; j<13; j++) {
            fineGridFacesLOH1Q(d).value[overlapCellSerialised*13+j] = 
              fineGridCellLOH1Q.value[patchCellSerialised*13+j];
          }
  
          patchCell(d)   = i+5-1.0;
          overlapCell(d) = i;
          
          patchCellSerialised   = peano4::utils::dLinearised(patchCell,5);
          overlapCellSerialised = serialisePatchIndex(overlapCell,d);
          for (int j=0; j<13; j++) {
            fineGridFacesLOH1Q(d+Dimensions).value[overlapCellSerialised*13+j] = 
              fineGridCellLOH1Q.value[patchCellSerialised*13+j];
          }
        }
      }
    }
    logTraceOut( "touchCellLastTime(...)" );
  }
}


