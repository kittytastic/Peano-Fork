#include "peano4/utils/Globals.h"
// have to know whether we are using MPI
#include "config.h"

Packed-Type: short int;

Constant: Dimensions hint-value 4;
Constant: TwoPowerD;


class peano4::grid::GridVertex {
  enum State {
    HangingVertex,
    New,Unrefined,Refined,RefinementTriggered,Refining,EraseTriggered,Erasing,Delete
  };
  
  persistent packed parallelise packed State  state;
  persistent        parallelise int  adjacentRanks[TwoPowerD];
  
  /**
   * I have to backup the ranks, as I immediately update the adjacency lists
   * after I've received the updates from a neighbour.
   */
  discard           int  backupOfAdjacentRanks[TwoPowerD];

  persistent packed             bool hasBeenAntecessorOfRefinedVertexInPreviousTreeSweep;
  persistent packed parallelise bool isAntecessorOfRefinedVertexInCurrentTreeSweep;

  /**
 	   * Should be from 0 to TwoPowerD
   */
  discard    packed parallelise int  numberOfAdjacentRefinedLocalCells;

  /**
   * A vertex is outside, if all @f$ 2^d @f$ adjacent cells are outside. In this
   * case, no events are called for it. 
   */
  #ifdef PeanoDebug
  persistent parallelise double  x[Dimensions];
  persistent parallelise int     level;
  #endif
};
